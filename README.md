# 因子挖掘：反转&小市值。

- **动量因子**的经济学原理多以行为金融学解释（过度反应、反应不足）。那么根据EMH，在相对弱有效的市场下这些因子的效果会更好。经实证，动量因子在中国市场具有相对强的识股能力；

- **市值因子**则一直是金融市场非常重要的因子，尤其是在中国市场的效果特别好；

此项目旨在研究这两种中国A股市场表现相对较好的因子，并尝试通过这两种因子的组合挖掘新的因子，并评估其效果。

> 反转与动量因子最早在1993年由Jegadeesh和Titman在[《Returns to Buying Winners and Selling Losers: Implication for Stock Market Efficiency》, *The Journal of Finance, 1993*](http://www.business.unr.edu/faculty/liuc/files/BADM742/Jegadeesh_Titman_1993.pdf)里面提出，本研究中所称的“反转”、“动量”因子计算方式与此论文大致相同。
> 
> 其它细节之处之不同则参考了这篇研究中国A股市场异象的论文：[《Anomalies in Chinese A-Share》, 2017](https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2955144)。其论文中关于股市场反转的实证研究我也复现验证了一次，在收益、规律、统计显著性（t统计量）上都与论文吻合，这部分的代码见[Research.py](https://github.com/KasperLXK/Contrarian/blob/master/Contrarian%20Codes/Research.py)。

# 1. 回测及研究方式

## 1.1 研究方式

- **数据来源**：[CSMAR](http://www.gtarsc.com/Home)，所需数据及数据说明保存在[Contrarian Data](https://github.com/KasperLXK/Contrarian/tree/master/Contrarian%20Data)。
- **数据分析工具**：主要采用Python进行数据分析，部分步骤采用R，大部分研究代码可在[Contrarian Codes](https://github.com/KasperLXK/Contrarian/tree/master/Contrarian%20Codes)中找到。

## 1.2 回测方式

- **Rank&Hold**（排序&持有）：采用“对过去J期因子暴露总和排序，以此决定下一期的投资组合，并持有K期”的方式捕捉因子风格
> 以下简称为 “因子名 J-K” ，例如 “反转 6-3” 表示每一次交易观察过去6个月收益表现最差的输家组合作为下一期的投资组合，并持有该组合3个月。
- **满仓运行**：每次持仓都（尽可能）用全部资金；
- **增量调仓**：每次调仓时，上一期投资组合与下一期投资组合重合的部分只交易其差额；
- **交易成本**：按照<u>双向千分之二</u>收取交易费用；
- **换仓**：不加减仓，净值变化的计算按累计复利，持有K期期间不调仓，直到K期结束后才进行下一次交易；


# 2. 因子选择

## 2.1 反转因子

在发达金融市场上，中长期的动量因子（如美股3个月动量）表现较佳。但据我的研究，尽管中长期的动量因子在中国市场也具有一定收益能力，但较为**短期、反转**的因子表现更佳。

回测结果也显示在A股市场动量因子中**反转因子**（做多输家组合、做空赢家组合）又较传统**动量因子**（做多赢家组合、做空输家组合）表现好得多。

而据我的研究，在反转因子中，输家反转的效应又比赢家反转的效应强得多，实际上相同的观察期下，赢家经常不反转，而抵消传统的反转因子的效果，倘若采用这种方式捕捉反转因子（单边做多输家组合）其效果又较传统的反转因子（做多输家组合、做空输家组合）更加。

> 况且中国股票市场还没有完善的做空机制。

在排序期与持有期的选择上，单边做多输家策略：

- 在超短期（介于一分钟到一天之间）的反转效应很显著，超额收益高
- 在短中期（介于一天到三个月之间）的反转效应最显著，超额收益最高；
- 在中长期（介于四个月到一年之间）的反转效应也很显著，超额收益高；
- 在超长期（介于一年到十年之间）的反转效应相对显著，具有一定的超额收益；

> 这一策略相对于国外发达金融市场几乎都“快了一拍”，侧面说明我国A股市场风格轮换相对快。

但考虑交易成本后，超短期交易策略又有过于高的交易成本而抹杀了它的超额收益；超长期策略则由于样本量少，虽然具有统计上的显著性，但现实中的说服力还有待考证。

> 不过超长期反转策略由于几乎可以忽略的交易成本而有挺诱人的回测曲线。

综上，本研究暂时专注于**排序持有期在1-6个月的单边做多输家反转因子**。

## 2.2 小市值因子

小市值因子在全世界的金融市场都有不错的表现，在中国市场更是有十分强劲的收益能力（尽管2017年后有所减弱）.同时中国市场市值的波动率也较国际市场更大，风格轮换更快，根据回测，较小的观察期窗口更能够捕捉到小市值因子。

在小市值与大市值的选择上，由于小市值大幅超越了大市值因子，故暂只研究小市值因子。

与上述反转因子的研究方法相仿，我们采用“排序并持有”的方式研究小市值，并大致得到了与反转相类似的结论。

故暂定主要研究**排序持有期在1-6个月的小市值因子**。

# 3. 因子初步研究

## 3.1 排序持有期研究

我们采用这样的方式进行“反转&小市值”因子的初步研究。

- 尝试不同排序持有期，以“排序期-持有期”表示，单位皆为月。（如“3-2”表示排序3个月持有2个月）；
- 每一期将全部A股按照过去排序期内累计收益排序，取排在最后（即过去排序期收益最差）的20%，作为**输家组合**；
> 20%的分层方式暂沿用自论文的实证方式。
- 同时取出排序期内流通市值最小的200支股票，作为**小市值组合**；
- 取输家组合与小市值组合的**交集**作为下一期的投资组合；
> 注意：由于取了两个组合的交集，故最终股票数量往往远小于两个组合原有的股票数量。例如原本收益最差的20%输家组合有600+支股票，而小市值组合有200支股票，取交集后往往只有100+支股票。
- 投资组合内各股票等权交易
- 计入交易成本（双向2‰）
- 样本期为2008年至2017年（闭区间）

### 3.1.1 排序持有期研究（1-3个月）

研究排序持有期在1-3个月的回测表现。

不同排序持有期实际上具有相似的表现，除了3-1策略稍微异常地突出。

排序期持有期为1-3个月的净值图👇。

![1-3个月净值.png](https://i.loli.net/2019/03/27/5c9b23762691c.png)

从净值图也可以看出这一点。

但实际上这样的结论（1-3个月排序持有期表现相近）可能是因为被不同的交易成本所造成的错觉（持有期1个月则每月调仓，持有期3个月则每3个月调仓，交易成本不同）。

假如去除交易成本，再看1-3个月排序持有期的净值图👇：

![1-3个月净值去除交易成本.png](https://i.loli.net/2019/03/27/5c9b24ebf30e2.png)

去除交易成本后，我们就能看出短持有期（1个月）更具优势。

进一步的研究也揭示出1-3个月排序持有期下这样的大致规律：

- **持有期越短，收益率越高**
- **排序期越长，收益率越高**
> 但计入交易成本后短持有期的高收益被抵消。

### 3.1.2 排序期研究

研究持有期固定为1个月的时候不同持有期的回测表现。
分别尝试1、3、6、9、12个月等排序期，但从回测表现上看，排序期并非总是越长越好，实际上，除了排序3个月表现异常好以外，总体规律是**排序期越短，收益率越高**。

> 但3-1的策略收益率确实比其它策略都显著的高。在后续的模拟盘研究中也表现出这一点。

### 3.1.3 持有期研究

尝试固定3个月的排序期，研究不同持有期的影响。则表现出与原来一样的规律：**持有期越短，收益率越高**。

但值得一提的是，如果把排序其持有期一并拉长到一年或以上，则收益率又更胜一筹👇。

![排序持有期研究.png](https://i.loli.net/2019/03/27/5c9b2a657ad55.png)

从净值图中可以看出，12-12策略的回测表现超过了中短期策略。

即**长排序长持有同样具有高收益率**。

### 3.1.4 排序持有期研究（6-12个月）

研究排序持有期在半年以上的回测表现👇。
结论为9-12、12-12等策略表现都能够超过前面1-3个月的表现。

## 3.2 因子进一步研究

回测1-18个月的所有排序持有期排列组合，并统计其回测指标。
回测统一采用以下规律：

- “输家”：表示单边做多排序期收益最差的20%股票
- “赢家”：表示单边做多排序期收益最好的20%股票
- “小市值”：表示只交易排序期市值最小的200支股票
- “大市值”：表示只交易排序期市值最大的200支股票
- “不限制”：表示不在市值上限制购买的股票
- 回测样本期：2009年至2017年（闭区间）
- 计入交易成本

主要指标最大值最小值及其对应策略统计👇：

 指标|CAGR|Sharpe|Volatility|Max Drawdown
 :--:|:--:|:--:|:--:|:--:
 最大值|32.61%|1.1036|1.2511|64.71%
 对应策略|3-1 输家 小市值|3-1 输家 小市值|9-1 输家 小市值|9-1 赢家 大市值
 最小值|-2.24%|-0.011|0.2665|34.79%
 对应策略|3-1 赢家 大市值|3-1 赢家 大市值|9-1 输家 不限制|9-1 输家 小市值

 从统计结果和上表中可以看出总体规律：

 - 小市值优于不限制，不限制又优于大市值
 - 输家优于赢家

 从夏普值看，表现最好的前五名：

 1. 3-1 输家 小市值
 2. 12-6 输家 小市值
 3. 9-6 输家 小市值
 4. 9-1 输家 小市值
 5. 6-1 输家 小市值

 表现最差的前五名：

 1. 9-6 赢家 大市值
 2. 9-1 赢家 大市值
 3. 12-6 赢家 大市值
 4. 1-1 赢家 大市值
 5. 3-1 赢家 大市值

可以清晰的看到反转+小市值组合表现显著好些。而排序期在3-9个月左右、持有期在1个月或6个月时表现较佳。

令人惊喜的一点是，在获得较高的收益的同时，输家+小市值的波动率也更低一些。

研究过程中也发现，区分输家赢家时采用的分层比例（20%）、区分小市值大市值时采用的股票数量（200支）也对最终效果影响很大。

总结：

- 在所有策略中，“3-1 输家 小市值”依然是最强的，接下来的研究会主要专注于这个策略；
- “中长期 输家 大市值”具有波动率等风险指标上的相对稳定性；
- 输家策略显著超越赢家；
> 有时候赢家策略甚至会带来负收益。
- 单纯考虑风险（波动率、追踪误差等）的话，表现最佳的策略是“输家 大市值”

## 3.3 其它因素研究

### 3.3.1 关于ST股票

> 这部分的回测采用米筐量化平台进行。除交易费用外规则与前述相同。

以表现最好的“3-1 输家 小市值”为例，倘若加上限制条件“不交易ST股票”，则CAGR从32.61%上升到36.73，提升12.63%。

> 有趣的是，“只交易ST”的收益率表现也比“不对ST做限制”要好。

### 3.3.2 市值加权

之前一直是等权交易，尝试进行市值加权。但结果并不好，无论是给大市值加高权重，还是给小市值加高权重，都比原本的等权表现要差。

### 3.3.3 波动率加权

尝试通过股票的波动率进行加权。给具有高波动率的股票加高权重，最终结果略微比未加权好些，并没有统计上的显著性，故放弃。


